
  <!DOCTYPE html>
  <html>
    <head>
      <!--Import materialize.css-->
      <link type="text/css" rel="stylesheet" href="lib/materialize/css/materialize.min.css"  media="screen,projection"/>
      <!--Let browser know website is optimized for mobile-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    </head>

    <body>
    
  <nav>
    <div class="nav-wrapper light-green">
      <a href="#" class="brand-logo center">SimpleRAK</a>
      <ul id="nav-mobile" class="left">
        <li><a id="show_menu" data-activates="global-menu"  href="#"><i class="mdi-navigation-menu"></i></a></li>
      </ul>
    </div>
  </nav>
  <ul id="global-menu" class="side-nav fixed">
        <li><a href="#">Menu</a></li>
        <li><a href="#">Mon Compte</a></li>
  </ul>
  <div class="progress" style="margin-top: 0;">
      <div class="indeterminate"></div>
  </div>  
  <div id="container">
  
  </div>  
  
  	  <script type="text/javascript" src="lib/jquery-2.1.3.min.js"></script>
      <script type="text/javascript" src="lib/materialize/js/materialize.min.js"></script>
      
      <script type="text/javascript" src="lib/ical.js"></script>
      
      <script type="text/javascript">
       $("nav #show_menu").sideNav();

	   var page_index = 0;
	   var pages = {};
	   
	   $("#container").hammer()
		
       $("#container").on("swipeleft",function(){
       	   page_index=(++page_index>pages.length)?pages.length:page_index
		 	$('#container').animate( { scrollLeft: (page_index*$(document).width())+"px" }, 150 );
	   });
       $("#container").on("swiperight",function(){
       	   page_index=(--page_index<0)?0:page_index
		   $('#container').animate( { scrollLeft: (page_index*$(document).width())+"px" }, 150 );
		});
       //
      
       var app = document.URL.indexOf( 'http://' ) === -1 && document.URL.indexOf( 'https://' ) === -1;
		if ( app ) {
			var ics_url = "http://resel.fr/services/rak/menu.ics";
		} else {
			var ics_url = "menu.ics";
		} 
       $.get(ics_url, function(d){
       	//console.log(d);
       	ics = ICAL.parse(d)
       	for(i=1; i<ics[2].length; i++){
       		if(ics[2][i][0]=="vevent"){
       			//console.log(ics[2][i])
       			//console.log([ics[2][i][1][0][3],ics[2][i][1][3][3],ics[2][i][1][4][3]])
       			var daytime = ics[2][i][1][4][3].split("T");
       			if (!pages.hasOwnProperty(daytime[0])) 
       				pages[daytime[0]] = {};
       				
       			pages[daytime[0]][daytime[1]] = ics[2][i][1][3][3];
       			//$(".progress").hide()
       			//$("#container").append(jour(i,ics[2][i][1][4][3],ics[2][i][1][3][3],ics[2][i][1][3][3]))
       		}
       	}
       	console.log(pages)
       	i = 0
       	for(var index in pages) { 
				var menu = pages[index]; 
       			$("#container").append(jour(i++,index,menu["12:00:00"],menu["19:15:00"]))	
		}
		
		
		if((new Date()).getHours()<13)
			$('.collapsible>li:first-child>.collapsible-header').addClass('active')
		else
			$('.collapsible>li:last-child>.collapsible-header').addClass('active')
			
       	$(".progress").hide()
       	$('.collapsible').collapsible();
       	
       	
		var day = (new Date()).toJSON().split("T")[0]
		console.log(day)
		page_index = parseInt($(".page>h5:contains('"+day+"')" ).parent().attr('id'))
		$('#container').animate( { scrollLeft: page_index*$(document).width()+"px" }, 150 );
		//$("#container").scrollLeft(parseInt($(".page>h5:contains('"+day+"')" ).parent().attr('id'))*$(document).width()+"px")
			
       	 /*	
       	 $('.page').click( function() { // Au clic sur un élément
			//var page = $(this).attr('href'); // Page cible
			var page = ".page:eq(2)"; // Page cible
			var speed = 350; // Durée de l'animation (en ms)
			$('#container').animate( { scrollLeft: $(page).offset().left }, speed ); // Go
			return false;
		});
		*/
       })
       
         function jour(id,date, matin, soir){
         	return '<div class="page" id="'+id+'"><h5 class="center-align">'+date+'</h5>'+accordion(matin, soir)+'</div>';
         }
         function accordion(matin, soir){
         return 	'<ul class="collapsible" data-collapsible="accordion">'+
            '<li><div class="collapsible-header"><i class="mdi-device-brightness-low"></i>Midi</div>'+
			  '<div class="collapsible-body"><p>'+matin.replace(/\n/g, "<br />")+'</p></div>'+
			'</li>'+
			'<li>'+
			  '<div class="collapsible-header"><i class="mdi-image-brightness-3"></i>Soir</div>'+
			  '<div class="collapsible-body"><p>'+soir.replace(/\n/g, "<br />")+'</p></div>'+
			'</li>'+
					'</ul>'
		};
      </script>
	<style>
	body {
		height:100%;
		width:100%;
		margin:0;padding:0;
	}
	#container {
		position:absolute;
		top:60px;left:0;bottom:0;right:0;
		/*background-color:#DDD;*/
		white-space: nowrap;
		overflow: hidden;
	}
	.page{
		height: 100%;
		width: 100%;
  		display: inline-block;
  		vertical-align: top;
	}
	</style>		       
    </body>
  </html>
